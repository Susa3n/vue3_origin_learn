{
  "version": 3,
  "sources": ["../src/index.ts", "../../shared/src/index.ts", "../src/effect.ts", "../src/baseHandles.ts", "../src/reactive.ts"],
  "sourcesContent": ["import {\r\n  reactive,\r\n  shallowReactive,\r\n  readonly,\r\n  shallowReadonly\r\n} from './reactive'\r\nimport {effect} from './effect'\r\nexport {\r\n  reactive,\r\n  shallowReactive,\r\n  readonly,\r\n  shallowReadonly,\r\n  effect\r\n}", "// src/index.ts\r\n/**\r\n * \u5224\u65AD\u5BF9\u8C61\r\n */\r\nexport const isObject = (value) =>{\r\n \u00A0 \u00A0return typeof value === 'object' && value !== null\r\n}\r\n/**\r\n * \u5224\u65AD\u51FD\u6570\r\n */\r\nexport const isFunction= (value) =>{\r\n \u00A0 \u00A0return typeof value === 'function'\r\n}\r\n/**\r\n * \u5224\u65AD\u5B57\u7B26\u4E32\r\n */\r\nexport const isString = (value) => {\r\n \u00A0 \u00A0return typeof value === 'string'\r\n}\r\n/**\r\n * \u5224\u65AD\u6570\u5B57\r\n */\r\nexport const isNumber =(value)=>{\r\n \u00A0 \u00A0return typeof value === 'number'\r\n}\r\n/**\r\n * \u5224\u65AD\u6570\u7EC4\r\n */\r\nexport const isArray = Array.isArray\r\n\r\n// \u5408\u5E76\r\nexport const assign = (target,...argus) => {\r\n  return Object.assign(target,...argus)\r\n} \r\n", "export function effect(fn,options:any = {}) {\r\n\r\n  const effect = createEffect(fn,options)\r\n  if(!options.lazy) {\r\n    effect()\r\n  }\r\n\r\n  return effect\r\n}\r\n\r\nlet uuid = 0\r\nconst effectStack = []\r\nlet activeEffect = null\r\nfunction createEffect(fn,options) {\r\n  const effect = function createReactiveEffect() {\r\n    if(!effectStack.includes(effect)) {\r\n      try {\r\n        effectStack.push(effect)\r\n        activeEffect = effect\r\n        return fn()\r\n      } finally {\r\n        effectStack.pop()\r\n        activeEffect = effectStack[effectStack.length-1]\r\n      }\r\n    }\r\n  }\r\n  effect.uuid = uuid++\r\n  effect._isEffect = true \r\n  effect.raw = effect\r\n  effect.options = options\r\n\r\n  return effect\r\n}\r\nconst targetMap = new WeakMap()\r\nexport function track(target,type,key) {\r\n  if(!activeEffect) {\r\n    return\r\n  }\r\n\r\n  let depsMap = targetMap.get(target) \r\n  if(!depsMap) {\r\n    depsMap = targetMap.set(target,new Map())\r\n  }\r\n\r\n  let dep = depsMap.get(key)\r\n  if(!dep) {\r\n    depsMap.set(key,(dep = new Set()))\r\n  }\r\n  if(!dep.has(activeEffect)) {\r\n    dep.add(activeEffect)\r\n  }\r\n\r\n\r\n}", "\r\nimport { assign, isObject } from '@my-vue/shared'\r\nimport { readonly, reactive } from './reactive'\r\nimport { TrackType } from \"./operations\"\r\nimport { track } from './effect'\r\n\r\nfunction createGetter(isShallow = false, isReadonly = false) {\r\n  return function get(target, key, receiver) {\r\n    let res = Reflect.get(target, key)\r\n    if (!isReadonly) {\r\n      // \u6536\u96C6\u4F9D\u8D56...\r\n      console.log('\u6536\u96C6\u4F9D\u8D56...', key);\r\n      track(target, TrackType.GET, key)\r\n    }\r\n\r\n    if (isShallow) {\r\n      return res\r\n    }\r\n\r\n    if (isObject(res)) {\r\n      isReadonly ? readonly(res) : reactive(res)\r\n    }\r\n    return res\r\n  }\r\n}\r\n\r\n\r\n\r\n\r\nfunction createSetter(isShallow = false) {\r\n  return function set(target, key, newValue, receiver) {\r\n    const res = Reflect.set(target, key, newValue, receiver)\r\n    return res\r\n  }\r\n}\r\nconst get = createGetter()\r\nconst shallowGet = createGetter(true)\r\nconst readonlyGet = createGetter(false, true)\r\nconst shallowReadonlyGet = createGetter(true, true)\r\nconst set = createSetter()\r\nconst shallowSet = createGetter(true)\r\n\r\nconst notSet = {\r\n  set: (target, key, newvalue) => {\r\n    console.warn(`not set on ${target} the key '${key}' `)\r\n  }\r\n}\r\n\r\nconst mutableHandlers = {\r\n  get,\r\n  set\r\n}\r\nconst shallowReactiveHandlers = {\r\n  get: shallowGet,\r\n  set: shallowSet\r\n}\r\n\r\nconst readonlyHandlers = assign({\r\n  get: readonlyGet,\r\n}, notSet)\r\nconst shallowReadonlyHandlers = assign({\r\n  get: shallowReadonlyGet,\r\n}, notSet)\r\n\r\nexport { mutableHandlers, shallowReactiveHandlers, readonlyHandlers, shallowReadonlyHandlers }", "\r\nimport {isObject} from '@my-vue/shared'\r\nimport {mutableHandlers,shallowReactiveHandlers,readonlyHandlers,shallowReadonlyHandlers} from './baseHandles'\r\n\r\nconst reactiveMap = new WeakMap()\r\nconst readonlyMap = new WeakMap()\r\nfunction createReactiveObject(target,readonly,baseHandlers) {\r\n  if(!isObject(target)) {\r\n    return target\r\n  }\r\n\r\n  const baseMap = readonly ? readonlyMap : reactiveMap\r\n\r\n  if(baseMap.get(target)) {\r\n    return baseMap.get(target)\r\n  }\r\n\r\n  let proxy = new Proxy(target,baseHandlers)\r\n  baseMap.set(target,proxy)\r\n  return proxy\r\n\r\n}\r\n\r\nfunction reactive(target) {\r\n  return createReactiveObject(target,false,mutableHandlers)\r\n}\r\nfunction shallowReactive(target) {\r\n  return createReactiveObject(target,false,shallowReactiveHandlers)\r\n\r\n} \r\nfunction readonly(target) {\r\n  return createReactiveObject(target,true,readonlyHandlers)\r\n\r\n} \r\nfunction shallowReadonly(target) {\r\n  return createReactiveObject(target,true,shallowReadonlyHandlers)\r\n}\r\nexport {\r\n  reactive,\r\n  shallowReactive,\r\n  readonly,\r\n  shallowReadonly\r\n}"],
  "mappings": "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",
  "names": ["effect", "get", "set", "readonly"]
}
